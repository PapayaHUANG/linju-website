---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

import { formatPosts } from '../../utils';
import Pagination from '../../components/Pagination.astro';
import PodcastCard from '../../components/PodcastCard.astro';

const allPodcasts = await getCollection('podcast');

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('podcast');

  const formattedPodcast = formatPosts(allPosts, {});

  return paginate(formattedPodcast, {
    pageSize: 5,
  });
}

const { page } = Astro.props;
const pathname = new URL(Astro.request.url).pathname.split('/');
const firstPath = pathname[1];

const { prevUrl, currentUrl, nextUrl, currentPage, lastPage } = page;
---

<MainLayout title="podcast">
  <container class="flex flex-col">
    <ol class="flex max-w-3xl flex-col space-y-16">
      {
        page.data.map((post) => (
          <li>
            <PodcastCard
              title={post.data.title}
              description={post.data.description}
              date={post.data.date}
              slug={post.slug}
            />
          </li>
        ))
      }
    </ol>

    {
      allPodcasts.length > 2 && (
        <div>
          <Pagination
            length={lastPage}
            currentPage={currentUrl}
            currentPage={currentPage}
            firstUrl={`/${firstPath}`}
            prevUrl={prevUrl}
            nextUrl={nextUrl}
            lastUrl={`/${firstPath}/${lastPage}`}
          />
        </div>
      )
    }
  </container>
</MainLayout>
