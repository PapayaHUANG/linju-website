---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

import { formatPosts } from '../../utils';
import Pagination from '../../components/Pagination.astro';
import PodcastCard from '../../components/PodcastCard.astro';

const allPodcasts = await getCollection('podcast');

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('podcast');

  const formattedPodcast = formatPosts(allPosts, {});

  return paginate(formattedPodcast, {
    pageSize: 5,
  });
}

const { page } = Astro.props;
const pathname = new URL(Astro.request.url).pathname.split('/');
const firstPath = pathname[1];

const { currentPage, lastPage } = page;
const { current, prev, next } = page.url;
---

<MainLayout title="podcast">
  <div class="mt-16 text-center">
    <h1 class="text-4xl lg:text-5xl font-bold lg:tracking-tight">播客单集</h1>
    <main class="mt-16 flex flex-col">
      <ol class="flex flex-col space-y-8">
        {
          page.data.map((post) => (
            <li>
              <PodcastCard
                title={post.data.title}
                description={post.data.description}
                date={post.data.date}
                slug={post.slug}
              />
            </li>
          ))
        }
      </ol>
    </main>
    <div class="mt-16">
      {
        allPodcasts.length > 5 && (
          <div>
            <Pagination
              length={lastPage}
              currentUrl={current}
              currentPage={currentPage}
              firstUrl={`/${firstPath}`}
              prevUrl={prev}
              nextUrl={next}
              lastUrl={`/${firstPath}/${lastPage}`}
            />
          </div>
        )
      }
    </div>
  </div>
</MainLayout>
